4.1 Test Scripts

```bash
mkdir -p scripts

cat > scripts/test-local.sh << 'EOF'
#!/bin/bash

# Local testing script for Solana KYC Compliance SDK
set -e

echo "ðŸ§ª Starting local test suite..."

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Function to print colored output
print_status() {
    echo -e "${GREEN}[âœ“]${NC} $1"
}

print_warning() {
    echo -e "${YELLOW}[!]${NC} $1"
}

print_error() {
    echo -e "${RED}[âœ—]${NC} $1"
}

# Check prerequisites
check_prerequisites() {
    echo "Checking prerequisites..."
    
    # Check Node.js
    if ! command -v node &> /dev/null; then
        print_error "Node.js not found. Please install Node.js 18 or higher."
        exit 1
    fi
    
    NODE_VERSION=$(node --version | cut -d'v' -f2)
    NODE_MAJOR=$(echo $NODE_VERSION | cut -d'.' -f1)
    
    if [ $NODE_MAJOR -lt 18 ]; then
        print_error "Node.js version must be 18 or higher. Current: $NODE_VERSION"
        exit 1
    fi
    
    print_status "Node.js $NODE_VERSION detected"
    
    # Check npm
    if ! command -v npm &> /dev/null; then
        print_error "npm not found"
        exit 1
    fi
    
    # Check Rust
    if ! command -v cargo &> /dev/null; then
        print_error "Rust not found. Please install Rust."
        exit 1
    fi
    
    # Check Solana CLI
    if ! command -v solana &> /dev/null; then
        print_warning "Solana CLI not found. Some tests may fail."
    else
        print_status "Solana CLI detected"
    fi
    
    print_status "All prerequisites satisfied"
}

# Install dependencies
install_dependencies() {
    echo "Installing dependencies..."
    npm ci
    print_status "Dependencies installed"
}

# Build everything
build_all() {
    echo "Building project..."
    
    # Build TypeScript SDK
    print_status "Building TypeScript SDK..."
    npm run build:sdk
    
    # Build Rust program
    print_status "Building Rust program..."
    npm run build:program
    
    print_status "Build completed"
}

# Start local validator
start_validator() {
    echo "Starting local Solana validator..."
    
    # Check if validator is already running
    if curl -s http://localhost:8899/health > /dev/null 2>&1; then
        print_status "Validator already running"
    else
        # Kill any existing validator
        pkill -f solana-test-validator 2>/dev/null || true
        
        # Start new validator
        solana-test-validator \
            --reset \
            --quiet \
            --bpf-program TokenzQdBNbLqP5VEhdkAS6EPFLC1PHnBqCXEpPxuEb token_program.so \
            --ledger test-ledger \
            > /dev/null 2>&1 &
        
        VALIDATOR_PID=$!
        
        # Wait for validator to start
        echo -n "Waiting for validator to start"
        for i in {1..30}; do
            if curl -s http://localhost:8899/health > /dev/null 2>&1; then
                echo ""
                print_status "Validator started (PID: $VALIDATOR_PID)"
                break
            fi
            echo -n "."
            sleep 1
        done
        
        if [ $i -eq 30 ]; then
            print_error "Validator failed to start"
            exit 1
        fi
    fi
}

# Deploy program
deploy_program() {
    echo "Deploying program..."
    
    PROGRAM_ID="KycCompliance111111111111111111111111111111111"
    
    # Check if program is already deployed
    if solana program show $PROGRAM_ID --url http://localhost:8899 > /dev/null 2>&1; then
        print_status "Program already deployed"
    else
        # Deploy program
        solana program deploy dist/program/kyc_compliance.so \
            --program-id $PROGRAM_ID \
            --url http://localhost:8899 \
            --keypair ~/.config/solana/id.json
        
        if [ $? -eq 0 ]; then
            print_status "Program deployed successfully"
        else
            print_error "Failed to deploy program"
            exit 1
        fi
    fi
}

# Run tests
run_tests() {
    echo "Running tests..."
    
    # Run Rust unit tests
    print_status "Running Rust unit tests..."
    cd programs/kyc-compliance
    cargo test --lib
    cd ../..
    
    # Run TypeScript unit tests
    print_status "Running TypeScript unit tests..."
    npm test
    
    # Run integration tests if validator is running
    if curl -s http://localhost:8899/health > /dev/null 2>&1; then
        print_status "Running integration tests..."
        npx mocha -r ts-node/register tests/typescript/integration/**/*.test.ts \
            --timeout 30000 \
            --exit
    else
        print_warning "Skipping integration tests (validator not running)"
    fi
}

# Run examples
run_examples() {
    echo "Running examples..."
    
    EXAMPLES=("register" "token" "transfer" "admin")
    
    for example in "${EXAMPLES[@]}"; do
        print_status "Running example: $example-investor.ts"
        
        if [ "$example" = "token" ]; then
            print_warning "Token example requires additional setup, skipping..."
            continue
        fi
        
        # Run example with timeout
        timeout 30s npx ts-node examples/${example}-investor.ts 2>&1 | \
            grep -E "(âœ…|âŒ|===|error)" || \
            print_warning "Example $example may require manual setup"
        
        echo ""
    done
}

# Cleanup
cleanup() {
    echo "Cleaning up..."
    
    # Kill validator if we started it
    if [ ! -z "$VALIDATOR_PID" ]; then
        print_status "Stopping validator (PID: $VALIDATOR_PID)"
        kill $VALIDATOR_PID 2>/dev/null || true
    fi
    
    # Clean up test ledger
    if [ -d "test-ledger" ]; then
        rm -rf test-ledger
    fi
    
    print_status "Cleanup completed"
}

# Main execution
main() {
    echo "========================================"
    echo "  Solana KYC Compliance SDK Test Suite  "
    echo "========================================"
    echo ""
    
    trap cleanup EXIT
    
    # Step 1: Check prerequisites
    check_prerequisites
    
    # Step 2: Install dependencies
    install_dependencies
    
    # Step 3: Build
    build_all
    
    # Step 4: Start validator
    start_validator
    
    # Step 5: Deploy program
    deploy_program
    
    # Step 6: Run tests
    run_tests
    
    # Step 7: Run examples
    run_examples
    
    echo ""
    echo "========================================"
    echo "          Test Suite Completed          "
    echo "========================================"
}

# Run main function
main "$@"
EOF

chmod +x scripts/test-local.sh
```

```bash
cat > scripts/coverage.sh << 'EOF'
#!/bin/bash

# Coverage reporting script
set -e

echo "ðŸ“Š Generating coverage reports..."

# Install coverage tools if needed
if ! command -v nyc &> /dev/null; then
    npm install -g nyc
fi

# Create coverage directory
mkdir -p coverage

# Generate TypeScript coverage
echo "Generating TypeScript coverage..."
npx nyc mocha -r ts-node/register tests/typescript/unit/**/*.test.ts \
    --reporter=json \
    --reporter-options output=coverage/coverage-final.json

# Generate reports
echo "Generating reports..."
npx nyc report --reporter=text > coverage/coverage.txt
npx nyc report --reporter=html
npx nyc report --reporter=lcov > coverage/lcov.info

# Show summary
echo ""
echo "Coverage Summary:"
echo "================="
cat coverage/coverage.txt | grep -A 5 "File" | head -20

# Generate badge if jq is available
if command -v jq &> /dev/null; then
    COVERAGE=$(cat coverage/coverage-final.json | jq '.total.lines.pct')
    echo "{\"schemaVersion\": 1, \"label\": \"coverage\", \"message\": \"${COVERAGE}%\", \"color\": \"green\"}" > coverage/badge.json
    echo "Coverage badge generated: $COVERAGE%"
fi

echo ""
echo "HTML report available at: coverage/index.html"
echo "LCOV report available at: coverage/lcov.info"
EOF

chmod +x scripts/coverage.sh
```

```bash
cat > scripts/benchmark.sh << 'EOF'
#!/bin/bash

# Performance benchmarking script
set -e

echo "âš¡ Running performance benchmarks..."

# Create results directory
mkdir -p benchmark-results
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
RESULTS_FILE="benchmark-results/results_${TIMESTAMP}.json"

# Check if validator is running
if ! curl -s http://localhost:8899/health > /dev/null 2>&1; then
    echo "Starting local validator for benchmarks..."
    solana-test-validator --reset --quiet &
    VALIDATOR_PID=$!
    sleep 10
fi

# Run benchmarks
echo "Running benchmarks..."
node -e "
const { performance } = require('perf_hooks');
const { ComplianceClient } = require('./dist');
const { Connection, Keypair, PublicKey } = require('@solana/web3.js');

async function runBenchmarks() {
    const connection = new Connection('http://localhost:8899');
    const client = new ComplianceClient({
        connection,
        programId: new PublicKey('KycCompliance111111111111111111111111111111111'),
    });
    
    const results = {
        timestamp: new Date().toISOString(),
        benchmarks: []
    };
    
    // Benchmark 1: PDA generation
    console.log('Benchmark 1: PDA generation...');
    const start1 = performance.now();
    const pdas = [];
    for (let i = 0; i < 100; i++) {
        const wallet = Keypair.generate().publicKey;
        const pda = await client.getProgramPDAs(wallet);
        pdas.push(pda);
    }
    const end1 = performance.now();
    results.benchmarks.push({
        name: 'pda_generation',
        iterations: 100,
        duration_ms: end1 - start1,
        ops_per_sec: 100 / ((end1 - start1) / 1000)
    });
    
    // Benchmark 2: Status checks
    console.log('Benchmark 2: Status checks...');
    const wallets = Array(50).fill(0).map(() => Keypair.generate().publicKey);
    const start2 = performance.now();
    const statuses = await Promise.all(wallets.map(wallet => client.getStatus(wallet)));
    const end2 = performance.now();
    results.benchmarks.push({
        name: 'status_checks',
        iterations: 50,
        duration_ms: end2 - start2,
        ops_per_sec: 50 / ((end2 - start2) / 1000)
    });
    
    // Benchmark 3: Transfer validation
    console.log('Benchmark 3: Transfer validation...');
    const transfers = Array(100).fill(0).map(() => ({
        from: Keypair.generate().publicKey,
        to: Keypair.generate().publicKey,
        amount: Math.floor(Math.random() * 1000000000)
    }));
    const start3 = performance.now();
    const validations = await Promise.all(
        transfers.map(t => client.checkTransfer(t.from, t.to, t.amount))
    );
    const end3 = performance.now();
    results.benchmarks.push({
        name: 'transfer_validation',
        iterations: 100,
        duration_ms: end3 - start3,
        ops_per_sec: 100 / ((end3 - start3) / 1000)
    });
    
    // Save results
    require('fs').writeFileSync('$RESULTS_FILE', JSON.stringify(results, null, 2));
    
    // Print summary
    console.log('\\nBenchmark Results:');
    console.log('==================');
    results.benchmarks.forEach(b => {
        console.log(\`\${b.name}: \${b.ops_per_sec.toFixed(2)} ops/sec (\${b.duration_ms.toFixed(2)}ms for \${b.iterations} iterations)\`);
    });
}

runBenchmarks().catch(console.error);
"

# Clean up
if [ ! -z "$VALIDATOR_PID" ]; then
    echo "Stopping validator..."
    kill $VALIDATOR_PID
fi

echo ""
echo "Detailed results saved to: $RESULTS_FILE"
EOF

chmod +x scripts/benchmark.sh